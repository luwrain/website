
ENTITLE='Compilation of ISO-image'
RUTITLE='Сборка  ISO-образа'
TARGET=doc/devel/iso/index.php

luwrain-page-en

# Compilation of~ISO-image

luwrain-page-ru

# Сборка ISO-образа

Технология LUWRAIN позволяет вам получить свой собственный ISO-образ для~работы,
в~который вы можете внести любые необходимые вам изменения.
Мы постарались сделать этот процесс как можно проще и
не~накладываем никаких ограничений на~возможные варианты модификации.
Тем~не~менее, ознакомьтесь, пожалуйста, с~нашим [правовым статусом](local:/doc/legal/),
согласно которому мы просим не~публиковать изменённые образы без~отражения факта модификации в~названии вашего продукта,
поскольку это может ввести в~заблуждение других пользователей.
Название "LUWRAIN" без~дополнительных обозначений могут носить только образы,
выпущенные нашей командой.

## Требования

Сборку наших ISO-образов можно выполнить практически на~любой системе GNU/Linux. 
Вы должны иметь:

1. Систему GNU/Linux соответствующей разрядности
(сборку 64-битной версии можно выполнить только на~64-битной  системе),
в~которой у~вас есть полномочия суперпользователя _root_.
2. Утилиту _unsquashfs_ для~распаковки сжатого архива с~файлами корневой файловой системы.
3. Утилиту _git_ для~получения наших скриптов (необязательно).

## Подготовка

Для~того, чтобы создать свой собственный загрузочный образ LUWRAIN, вам необходимо иметь
ISO-образ соответствующей версии Ubuntu,
сборку LUWRAIN для~включения в~образ
и набор сборочных скриптов.
Актуальные образы LUWRAIN основаны на~Ubuntu 15.10
([прямая ссылка на~дистрибутив](http://releases.ubuntu.com/wily/ubuntu-15.10-desktop-i386.iso)).
После того, как образ загружен, его необходимо примонтировать к~системе,
чтобы иметь доступ к~его файлам:

```
sudo mkdir -p /mnt/disk
sudo mount -o loop ubuntu-15.10-desktop-i386.iso /mnt/disk
```

В~команде, приведённой выше, необходимо указать полный путь к~дистрибутиву Ubuntu,
куда он был загружен с~сайта.
Дистрибутивы LUWRAIN для~включения в~ISO-образы обычно помещаются
либо в~[каталог с~ISO-образами](http://download.luwrain.org/iso/),
либо в~каталог с~[nightly-сборками](http://download.luwrain.org/nightly/).
Они имеют пометку _"iso"_ в~своём имени и содержат подкаталоги для~одной или нескольких архитектур.
Сборочные скрипты находятся в~репозитории Git с~материалами для~Linux.
Их можно получить, выполнив команду:

```
git clone https://github.com/luwrain/linux.git
```

Если у~вас нет утилиты _git_,
то содержимое репозитория можно получить в~виде [zip-архива, доступного по~прямой ссылке](https://github.com/luwrain/linux/archive/master.zip).
Полный комплект скриптов находится в~подкаталоге ubuntu/<версия>/iso.

## Выполнение сборки

В~каталоге скриптов, полученном из~нашего _linux.git_, должен находиться  скрипт _lwr-iso_.
Это основной скрипт для~получения ISO-образа.
Содержимое сборки LUWRAIN для~включения  в~ISO-образ  должно быть помещено в~каталог _dist_
на~том~же уровне, что и файл _lwr-iso_.
В~каталог _dist_ должны быть напрямую помещены файлы только для~одной выбранной вами архитектуры
(куда, разумеется, вы можете внести любые нужные вам изменения).
После этого, необходимо запустить скрипт _lwr-iso_ с~правами суперпользователя _root_,
указав ему в~качестве первого аргумента путь к~каталогу, куда был примонтирован образ Ubuntu.
Поскольку в~примере выше использовался каталог _/mnt/disk_,
эта команда может иметь вид:

```
sudo ./lwr-iso /mnt/disk
```

Работа этой команды может занимать несколько минут,
и для~успешного выполнения требуется около 10ГБ свободного дискового пространства.
В~ходе работы будет задан вопрос о~раскладки клавиатуры в~терминале
(не~внутри самого LUWRAIN).
После завершения работы должен появиться файл _luwrain.iso_,
который может быть записан на~компакт-диск или флэшку, как это описано [здесь](local:/download/iso/writing/).

## Завершение работы

Команда _lwr-iso_ оставляет после работы каталог _lwrtmp-env_,
который необходимо удалить вручную.
Повторный запуск этой команды без~удаления каталога приведёт к~некорректному поведению.
В~случае аварийного завершения может остаться примонтированным каталог _/proc_ к~одному из~подкаталогов внутри _lwrtmp-env_,
который также необходимо отмонтировать вручную.

Если у~вас есть вопросы по~процессу сборки нашего образа,
не~стесняйтесь  задавать их~[наших рассылках](local:/community/mailing-lists/).
