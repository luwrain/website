
ENTITLE='Compilation of the ISO-image'
RUTITLE='Сборка  ISO-образа'
TARGET=doc/devel/iso/index.php

luwrain-page-en

# Compilation of~the~ISO-image

luwrain-page-ru

# Сборка ISO-образа

ISO-образы LUWRAIN, которые [публикуются на~нашем сайте](local:/download/iso/),
можно собрать самостоятельно.
Это открывает возможность как~внесения собственных модификаций  для~личных целей,
так и более глубокого погружения в~процесс разработки и освоения новых технологий.

## Требования

Сборку ISO-образов LUWRAIN можно выполнять на~большинстве современных дистрибутивов.
Основной процесс проходит  dв~окружении [chroot](https://ru.wikipedia.org/wiki/Chroot),
поэтому большинство необходимых утилит можно не~устанавливать в~вашу систему.
Вам потребуется:

1. Система GNU/Linux соответствующей разрядности
(сборку 64-битной версии можно выполнить только на~64-битной  системе),
в~которой у~вас есть полномочия суперпользователя root.
1. Утилиту unsquashfs для~распаковки сжатого архива с~файлами корневой файловой системы.
1. Утилиту git для~получения наших скриптов (необязательно).
1. Образ исходной системы Ubuntu Linux, на~основе которого будет производиться сборка.
В~настоящий момент в~основном используется [вот~этот](http://releases.ubuntu.com/xenial/ubuntu-16.04.6-desktop-amd64.iso)
(Необходима миграция на~18.04, [присоединяйтесь к~проекту](local:/doc/user/start/developers), чтобы помочь провести эту~работу).

## Подготовка

Прежде всего загрузите исходный образ Ubuntu Linux, сохранив его на~вашем жёстком диске.
Когда образ будет загружен, его необходимо примонтировать к~вашей системе,
чтобы иметь доступ к~его файлам:
Предположим, что мы будем это делать в~каталоге _/mnt/disk.
Следовательно, для~монтирования нужно вызвать  следующую команду:

* _sudo mount -o ro  ubuntu-16.04.6-desktop-amd64.iso /mnt/disk_

В~команде, приведённой выше, необходимо указать полный путь к~дистрибутиву Ubuntu,
куда он был загружен с~сайта.
В примере использовано наиболее типовое имя образа для~случая, когда он загружен в~текущий каталог.

Далее требуется загрузить сборочные скрипты,
отвечающими за~проведение всех необходимых  действий.
Их можно получить как из~[соответствующего репозитория Git](https://github.com/luwrain/linux/)
(загружаются при~помощи команды _git~clone_ с~указанием адреса репозитория),
так и из~некоторого nightly-релиза,
которые размещаются [здесь]((http://download.luwrain.org/nightly/)
(необходимо выбрать нужную дату или воспользоваться каталогом _latest_, содержащим всегда самый свежий nightly-релиз).
В~nightly-релизах нужно выбрать архив с~именем, начинающимся на~_luwrain-nightly_,
который содержит исходные тексты,
на~основе которых проводилась сборка.
Нужные скрипты будут находиться в~каталоге _ubuntu/16.04/iso_,
если вы используете содержимое репозитория Git,
или в~каталоге _linux/ubuntu/16.04/iso_,
если вы используете  исходные тексты nightly-релиза.

## Выполнение сборки

В~каталоге скриптов, полученном из~нашего _linux.git_, должен находиться  скрипт _lwr-iso_.
Это основной скрипт для~получения ISO-образа.
Содержимое сборки LUWRAIN для~включения  в~ISO-образ  должно быть помещено в~каталог _dist_
на~том~же уровне, что и файл _lwr-iso_.
В~каталог _dist_ должны быть напрямую помещены файлы только для~одной выбранной вами архитектуры
(куда, разумеется, вы можете внести любые нужные вам изменения).
После этого, необходимо запустить скрипт _lwr-iso_ с~правами суперпользователя _root_,
указав ему в~качестве первого аргумента путь к~каталогу, куда был примонтирован образ Ubuntu.
Поскольку в~примере выше использовался каталог _/mnt/disk_,
эта команда может иметь вид:

```
sudo ./lwr-iso /mnt/disk
```

Работа этой команды может занимать несколько минут,
и для~успешного выполнения требуется около 10ГБ свободного дискового пространства.
В~ходе работы будет задан вопрос о~раскладки клавиатуры в~терминале
(не~внутри самого LUWRAIN).
После завершения работы должен появиться файл _luwrain.iso_,
который может быть записан на~компакт-диск или флэшку, как это описано [здесь](local:/download/iso/writing/).

## Завершение работы

Команда _lwr-iso_ оставляет после работы каталог _lwrtmp-env_,
который необходимо удалить вручную.
Повторный запуск этой команды без~удаления каталога приведёт к~некорректному поведению.
В~случае аварийного завершения может остаться примонтированным каталог _/proc_ к~одному из~подкаталогов внутри _lwrtmp-env_,
который также необходимо отмонтировать вручную.

Если у~вас есть вопросы по~процессу сборки нашего образа,
не~стесняйтесь  задавать их~[наших рассылках](local:/community/mailing-lists/).
