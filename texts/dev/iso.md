
ENTITLE='Compilation of the ISO-image'
RUTITLE='Сборка  ISO-образа'
TARGET=doc/devel/iso/index.php

luwrain-page-en

# Compilation of~the~ISO-image

luwrain-page-ru

# Сборка ISO-образа

См.~также:

* [Каталог с~nightly-релизами](http://download.luwrain.org/nightly/latest/)

ISO-образы LUWRAIN, которые [публикуются на~нашем сайте](local:/download/iso/),
можно собрать самостоятельно.
Это открывает как~возможность внесения собственных модификаций  для~личных целей,
так и возможность более глубокого погружения в~процесс разработки и освоения новых технологий.

## Требования

Сборку ISO-образов LUWRAIN можно выполнять на~большинстве современных дистрибутивов GNU/Linux.
Основной процесс проходит  в~окружении [chroot](https://ru.wikipedia.org/wiki/Chroot),
поэтому большинство необходимых утилит можно не~устанавливать в~вашу систему.

Для~работы вам потребуется:

1. Система GNU/Linux соответствующей разрядности
(сборку 64-битной версии можно выполнить только на~64-битной  системе),
в~которой у~вас есть полномочия суперпользователя root.
1. Утилита unsquashfs для~распаковки сжатого архива с~файлами корневой файловой системы.
1. Утилита git для~получения наших скриптов (необязательно).
1. Образ исходной системы Ubuntu Linux, на~основе которого будет производиться сборка.
В~настоящий момент в~основном используется [ubuntu-16.04.6-desktop-amd64.iso этот](http://releases.ubuntu.com/xenial/ubuntu-16.04.6-desktop-amd64.iso)
(Необходима миграция на~18.04, [присоединяйтесь к~проекту](local:/doc/user/start/developers), чтобы помочь провести эту~работу).

## Подготовка окружения

Прежде всего, загрузите исходный образ Ubuntu Linux, сохранив его на~вашем жёстком диске.
Когда образ будет загружен, его необходимо примонтировать к~вашей системе,
чтобы иметь доступ к~его файлам.
Предположим, что мы будем это делать в~каталоге _/mnt/disk_.
Следовательно, для~монтирования нужно вызвать  следующую команду:

* _sudo mount -o ro  ubuntu-16.04.6-desktop-amd64.iso /mnt/disk_

В~команде, приведённой выше, необходимо указать полный путь к~дистрибутиву Ubuntu Linux,
куда он был загружен с~сайта.
В примере использовано наиболее типовое имя образа для~случая, когда он загружен в~текущий каталог.

Далее требуется загрузить сборочные скрипты,
отвечающие за~проведение всех необходимых  действий.
Их можно получить как из~соответствующего нашего репозитория Git по~адресу~[https://github.com/luwrain/linux/](https://github.com/luwrain/linux/)
(загружаются при~помощи команды _git~clone_ с~указанием адреса репозитория),
так и из~любого nightly-релиза,
которые публикуются [здесь](http://download.luwrain.org/nightly/)
(необходимо выбрать нужную дату или воспользоваться каталогом _latest_, всегда содержащим самый свежий nightly-релиз).
В~nightly-релизах нужно выбрать архив с~именем, начинающимся на~_luwrain-nightly_,
который содержит исходные тексты,
на~основе которых проводилась сборка.

Нужные скрипты будут находиться в~каталоге _ubuntu/16.04/iso_,
если вы используете содержимое репозитория Git,
или в~каталоге _linux/ubuntu/16.04/iso_,
если вы используете  исходные тексты nightly-релиза.

Наконец, необходимо выбрать нужный релиз LUWRAIN,
который будет использован для~оформления в~виде ISO-образа.
Проще всего это сделать, использовав один из~nightly-релизов, упомянутых выше.
В~каждом из~них есть архив, имя которого начинается с~пометки _luwrain-iso_.
Каждый такой архив содержит один или несколько профилей,
среди которых требуется выбрать наиболее подходящий и поместить содержимое соответствующего каталога
в~подкаталог _dist_ в~каталоге со~скриптами, отвечающими за~процесс сборки.
Таким образом, у~вас должен быть каталог, путь к~которому оканчивается на~_ubuntu/16.04/iso/dist_.

## Запуск процесса сборки

В~каталоге скриптов должен находиться  скрипт _lwr-iso_.
Его необходимо вызвать с~полномочиями суперпользователя root,
указав три~аргумента:

1. Каталог, куда примонтирован исходный образ дистрибутива. Ранее мы использовали для~этого _/mnt/disk_.
1. Обозначение версии системы, которое может быть любой последовательностью.
1. Обозначение национального профиля. В~настоящий момент допускается _ru_ или _en_.

Вызов команды может быть таким:

* _./lwr-iso /mnt/disk 2.0.0 ru_

Для~получения полномочий суперпользователя root
можно предварительно вызвать команду _sudo~su_.
Обычный вызов _sudo_ не~подходит,
поскольку из~соображений безопасности запрещён вызов команд не~из~системных каталогов.

Работа этой команды может занять несколько минут,
и для~успешного выполнения требуется около 10ГБ свободного дискового пространства.
После завершения работы должен появиться файл luwrain.iso,
который может быть записан на~компакт-диск или флэшку.
Весь вывод процесса сборки, включая возможные ошибки, сохраняется в~файл _/tmp/lwr-iso.log_.

## Завершение работы

Команда _lwr-iso_ оставляет после работы каталог _lwrtmp-env_,
который необходимо удалить вручную.
Повторный запуск этой команды без~удаления каталога приведёт к~некорректному поведению.
В~случае аварийного завершения может остаться примонтированным каталог _/proc_ к~одному из~подкаталогов внутри _lwrtmp-env_,
который также необходимо отмонтировать вручную.

Если у~вас есть вопросы по~процессу сборки нашего образа,
не~стесняйтесь  задавать их~в~[наших рассылках](local:/community/mailing-lists/)!
